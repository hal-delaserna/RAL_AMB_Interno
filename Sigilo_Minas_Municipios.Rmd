---
title: " COEMI/SGR"
subtitle: "<br /><br /><br /><br /> Quantidade de Mineradoras por Município <br />"
date: "`r Sys.Date()`"
output:
  # rmdformats::downcute:  
   rmdformats::robobook:    
     self_contained: true
     default_style: "light"
     downcute_theme: "default"
     highlight: kate
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
#       rm(list = ls())
library(tidyverse)
library(rmarkdown)
library(DT)
options(editor = 'notepad')
knitr::opts_chunk$set(echo = TRUE)
```

```{r carregando Bases INTERNAS, echo=FALSE, message=FALSE, warning=FALSE}
# source('./data/Dados_Abertos_ANM/AMB_Dados_Abertos.R')

# source('./data/Dados_Abertos_ANM/SCM_Microdados_CadMIN.R')
# cfem <- read_rds('./data/CFEM_Dados_Abertos.RDATA')
# processos_SCM <- read_rds('./data/Processos_ANM_Dados_Abertos.RDATA')

# source("./R/carregamento_Bases_AMB_outras.R")


producaoBRUTA <-
  read.table(
    "./data/CubosDBAMB_MovimentacaoProducaoBruta_AGREGADOS.csv", header = TRUE, sep = ",",dec = ".",
    fill = TRUE, quote = "", fileEncoding = 'UTF-8')

df <-
  read.table(
    "./data/CubosDBAMB_MovimentacaoProducaoBruta.csv", header = TRUE, sep = ",",dec = ".",
    fill = TRUE, quote = "", fileEncoding = 'UTF-8')

producaoBRUTA <- rbind(producaoBRUTA, df)



producaoBENEFICIADA <-
  read.table(
    "./data/CubosDBAMB_MovimentacaoProducaoBeneficiada.csv", header = TRUE, sep = ",", dec = ".",
    fill = TRUE, quote = "", fileEncoding = 'UTF-8')


```


Dados do AMB (RAL)


<br />

## Produção Bruta


```{r producaoBRUTA-Ano, echo=FALSE, message=FALSE, eval=TRUE}

df_A <- 
  summarise(
    group_by(filter(producaoBRUTA, Ano.Base.Ral == 2021)
             ,Ano.Base.Ral
             ,Município.Mina
             ,Substância.Agrupadora),
    "N de Empresas" = length(unique(CPF.CNPJ.Titular)))

DT::datatable(
  df_A,
  extensions = 'Buttons',
  caption = 'Quantidade de Empresas por Município e Substância',
  rownames = F,
  escape=FALSE,
  filter = list(position = 'top', clear = FALSE),
  options = list(
    dom = 'Blfrtip',
    buttons = c('excel'),
    columnDefs = list(list(className = 'dt-center', targets = c(0,3))),
    searching = T,
    paging = TRUE,
    info= FALSE
    ))

```

<br />

```{r Graf 3, echo=FALSE, message=FALSE}

df_A$`N de Empresas` |> table() |> barplot()

```

<br />

## Produção Beneficiada

```{r producaoBENEFICIADA-Ano, echo=FALSE, message=FALSE, eval=TRUE}

df_B <- 
  summarise(
    group_by(filter(producaoBENEFICIADA, Ano.Base.Ral == 2021)
             ,Ano.Base.Ral
             ,Município.Usina
             ,Substância.Agrupadora),
    "N de Empresas" = length(unique(CPF.CNPJ.Titular)))


DT::datatable(
  df_B,
  extensions = 'Buttons',
  caption = 'Quantidade de Empresas por Município e Substância',
  rownames = F,
  escape=FALSE,
  filter = list(position = 'top', clear = FALSE),
  options = list(
    dom = 'Blfrtip',
    buttons = c('excel'),
    columnDefs = list(list(className = 'dt-center', targets = c(0,3))),
    searching = T,
    paging = TRUE,
    info= FALSE
    ))

```



<br />


```{r Graf 1, echo=FALSE, message=FALSE}

df_B$`N de Empresas` |> table() |> barplot()

```

<br />

<br /><br /><br />




```{css, echo = FALSE, eval = T}

.page-inner section#content.normal {
  background-image: url("./img/anm315x66azul.png");
  background-position: top right;
  background-size: 20%;
  background-repeat: no-repeat;
}

.body-inner {
  background-image: url("./img/barra_horizontal_palito.png");
  background-position: bottom;
  background-size: 100%;
  background-repeat: no-repeat;
}

.title {
  color: #004C78;
  font-family: acumin-pro, sans-serif; 
  font-size: 30px;
  font-weight: bold;
  font-stretch: condensed;
  text-align:left;
    text-align:left;
    border-left: 7.5px solid #004C78;
    padding-left: 20px;
    height: 45px;
} 

.subtitle {
  color: #004C78;
  font-family: acumin-pro, sans-serif; 
  font-size: 70px;
  font-weight: bold;
  font-stretch: condensed;
  text-align:center;
}


.section.level1 h1 {
  color: #004C78;
  font-family: acumin-pro, sans-serif; 
  font-size: 20pt;
  font-weight: bold;
  font-stretch: condensed;
  text-align:left;
    border-left: 3.2px solid #004C78;
    padding-left: 8px;
    height: 35px;
}


.section.level2 h2 {
  color: #004C78;
  font-family: acumin-pro, sans-serif; 
  font-size: 18pt;
  font-weight: normal;
  font-stretch: condensed;
  text-align:left;
}

.h3,h4,h5,h6 {
  color: #004C78;
    font-family: acumin-pro, sans-serif;
  font-size: 24px;
  font-weight: medium;
  font-stretch: condensed;
  text-align:left;
}

p {
  text-align: justify;
}

caption {
	color: #262626;
	font-family: acumin-pro, sans-serif;
	font-size: 18px;
	font-weight: lighter;
	font-stretch: ultra-condensed;
	text-align: center;
	background-color: #dbd7d7;
	border: 0mm;
	padding: 12px;
	margin: 0mm;
}

.dataTables_wrapper .dt-buttons {
  float:none;  
  text-align:center;
}

```

